<apex:page standardController="MktCategoria__c" extensions="MktOrdeCate" showHeader="false" sideBar="false" showChat="false" standardStylesheets="false">
    <html>
        <head>
            <meta   charset="utf-8" />
            <meta   name="viewport" content="width=device-width, initial-scale=1" />
            <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
            <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
            <link   href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css" rel="stylesheet"/>
            <link   href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.min.css" rel="stylesheet"/>
            <script src="{!URLFOR($Resource.bootstrap3iso100, 'js/bootstrap.min.js')}"></script>
            <link   href="{!URLFOR($Resource.bootstrap3iso100, 'css/bootstrap.css')}" rel="stylesheet"/>
            <script>
                $(document).ready(function() {
                    // botões cima/baixo
                    $('#btn-up').bind('click', function() {
                        $('#principal option:selected').each( function() {
                            var newPos = $('#principal option').index(this) - 1;
                            if (newPos > -1) {
                                $('#principal option').eq(newPos).before("<option value='"+$(this).val()+"' selected='selected'>"+$(this).text()+"</option>");
                                $(this).remove();
                            }
                        });
                        console.log('chamada 1');
                        ClicaMove();
                    });
                    $('#btn-down').bind('click', function() {
                        var countOptions = $('#principal option').length;
                        $('#principal option:selected').each( function() {
                            var newPos = $('#principal option').index(this) + 1;
                            if (newPos < countOptions) {
                                $('#principal option').eq(newPos).after("<option value='"+$(this).val()+"' selected='selected'>"+$(this).text()+"</option>");
                                $(this).remove();
                            }
                        });
                        console.log('chamada 2');
                        ClicaMove();
                    });
                
                    // botões esquerda/direita
                    $('#btn-right').bind('click', function() {
                        $('#principal option:selected').each( function() {
                            $(this).css('background-color', '');
                            $('#auxiliar').append($(this).remove());
                        });
                        console.log('chamada 3');
                        ClicaMove();
                    });
                    $('#btn-left').bind('click', function() {
                        $('#auxiliar option:selected').each( function() {
                            if($('#principal option:selected').length>0)
                                $('#principal option:selected').last().after($(this).remove());
                            else
                                $('#principal').append($(this).remove());
                        });
                        console.log('chamada 4');
                        ClicaMove();
                    });
                    
                    // filtro
                    $("#filtro").on("keyup", function() {
                        var valor = $(this).val().toLowerCase();
                        $("#auxiliar [name='item']").each(function() {
                            if ($(this).text().toLowerCase().indexOf(valor) > -1)
                                $(this).show();
                            else
                                $(this).hide();
                        });
                        $("#principal [name='item']").each(function() {
                            if ($(this).text().toLowerCase().indexOf(valor) > -1 && valor!='')
                                $(this).css('background-color', 'yellow');
                            else
                                $(this).css('background-color', '');
                        });

                    });
                    console.log('chamada 5');
                    ClicaMove();

                });
                
                // botão salvar
                function copiaValores(){
                    var listaFilhaNova = [];
                    $("#principal option").each(function(){
                        listaFilhaNova.push($(this).val());
                    });
                    listaFilhaNova.toString();
                    stringFilhaNova.value = listaFilhaNova;
                    console.log(listaFilhaNova);
                }
                
                function ClicaMove(){
                    console.log('ClicaMove');
                    $('option').off('dblclick');
                    $('option').bind('dblclick', function() {
                        if($(this).parent().prop('id')=='auxiliar'){
                            if($('#principal option:selected').length>0)
                                $('#principal option:selected').last().after($(this).remove());
                            else
                                $('#principal').append($(this).remove());
                            console.log('chamada 6 (dentro)');
                            ClicaMove();
                        }else{
                            $(this).css('background-color', '');
                            $('#auxiliar').append($(this).remove());
                            console.log('chamada 7 (dentro)');
                            ClicaMove();
                        }
                    });
                    
                }
            </script>
        </head>
        
        <body style="margin-top:0px; margin-bottom:0px;">
            <div class="bootstrap-iso" style="margin-top:7px;">
                <div class="container-fluid">
                    
                    <apex:outputText rendered="{!IF(temListaParte == true, true, false)}" >
                        <div class="form-group">
                        
                            <div class="row" style="padding-bottom:6px;">
                                <div class="col-xs-50" style="padding:0px; margin:0px; font-weight:bold; text-align:center;">
                                    <small>Ordenados:</small>
                                </div>
                                <div class="col-xs-50" style="padding:0px; margin:0px; font-weight:bold; text-align:center;">
                                    <small>Falta Ordenar:</small>
                                </div>
                            </div>
                            
                            <div class="row" style="padding-bottom:10px;">
                                <apex:form style="background-color:white;">
                                    <apex:inputHidden value="{!stringFilhaNova}" id="stringFilhaNova" />
                                    <script>
                                        var stringFilhaNova = document.getElementById('{!$Component.stringFilhaNova}');
                                    </script>
                                
                                    <!--botões  cima/baixo + salvar-->
                                    <div class="col-xs-5" style="padding:0px;">
                                        <div class="btn-group-vertical" style="width: 100%;">
                                            <button type="button" id="btn-up" class="btn btn-sm btn-primary">
                                                <span class="glyphicon glyphicon-arrow-up"></span>
                                            </button>
                                            <button type="button" id="btn-down" class="btn btn-sm btn-primary">
                                                <span class="glyphicon glyphicon-arrow-down"></span>
                                            </button>
                                        </div>
                                        <br/>
                                        <br/>
                                        <apex:commandLink styleClass="btn btn-sm btn-success" onclick="copiaValores();" action="{!SalvarOrdem}" style="width: 100%;">
                                            <span class="glyphicon glyphicon-floppy-save"></span>
                                        </apex:commandLink>
                                        <br/>
                                        <br/>
                                        <apex:outputText rendered="{!IF(mensagem == 'sucesso', true, false)}" >
                                            <div class="alert alert-success" style="margin:0px; padding-top:6px;padding-bottom:6px;padding-left:12px;padding-right:12px;display:inline-block!important; width:100%!important;">
                                              <strong>&#10004;</strong>
                                            </div>
                                        </apex:outputText>
                                    </div>
                                </apex:form>
                                
                                <div class="col-xs-45">
                                    <select class="form-control" size="14" multiple="true" id="principal" style="font-size:12px!important; overflow-x: scroll!important">
                                        <apex:repeat value="{!listaParte}" var="parte">
                                            <apex:outputText rendered="{!IF(parte.Ordem__c != null, true, false)}" >                                                
                                                <option name='item' value="{!parte.Id}">{!parte.Nome__c} | {!parte.Modelo__c} | {!parte.Parte__r.Tipo_do_Produto__c} | FORN: {!parte.Parte__r.ProductCode} | HOSP: {!parte.Parte__r.StockKeepingUnit}</option>
                                            </apex:outputText>
                                        </apex:repeat>
                                    </select>
                                </div>
                                
                                <!--botões  add/remove -->
                                <div class="col-xs-5" style="padding:0px;">
                                    <div class="btn-group-vertical" style="width: 100%;">
                                        <button type="button" class="btn btn-primary" id="btn-right">
                                            <span class="glyphicon glyphicon-arrow-right"></span>
                                        </button>
                                        
                                        <button type="button" class="btn btn-primary" id="btn-left">
                                            <span class="glyphicon glyphicon-arrow-left"></span>
                                        </button>
                                    </div>
                                </div>
                                <div class="col-xs-45">
                                    <div class="input-group">
                                        <input type="text" class="form-control" id='filtro'/>                           
                                        <span class="input-group-addon"><i class="glyphicon glyphicon-filter"></i></span>
                                    </div>
                                    <select class="form-control" size="12" multiple="true" id="auxiliar" style="font-size:12px!important; overflow-x: scroll!important">
                                        <apex:repeat value="{!listaParte}" var="parte">
                                            <apex:outputText rendered="{!IF(parte.Ordem__c == null, true, false)}" >                                                
                                                <option name='item' value="{!parte.Id}">{!parte.Nome__c} | {!parte.Modelo__c} | {!parte.Parte__r.Tipo_do_Produto__c} | FORN: {!parte.Parte__r.ProductCode} | HOSP: {!parte.Parte__r.StockKeepingUnit}</option>
                                            </apex:outputText>
                                        </apex:repeat>
                                    </select>
                                </div>
                                
                            </div>
                        </div>

                    </apex:outputText>
                    
                    <apex:outputText rendered="{!IF(temListaCategoria == true, true, false)}" >
                        <div class="form-group">
                        
                            <div class="row" style="padding-bottom:6px;">
                                <div class="col-xs-50" style="padding:0px; margin:0px; font-weight:bold; text-align:center;">
                                    <small>Ordenados:</small>
                                </div>
                                <div class="col-xs-50" style="padding:0px; margin:0px; font-weight:bold; text-align:center;">
                                    <small>Falta Ordenar:</small>
                                </div>
                            </div>
                        
                            <div class="row" style="padding-bottom:10px;">
                                
                                <apex:form style="background-color:white;">
                                    <apex:inputHidden value="{!stringFilhaNova}" id="stringFilhaNova" />
                                    <script>
                                        var stringFilhaNova = document.getElementById('{!$Component.stringFilhaNova}');
                                    </script>
                                
                                    <!--botões  cima/baixo + salvar-->
                                    <div class="col-xs-5" style="padding:0px;">
                                        <div class="btn-group-vertical" style="width: 100%;">
                                            <button type="button" id="btn-up" class="btn btn-sm btn-primary">
                                                <span class="glyphicon glyphicon-arrow-up"></span>
                                            </button>
                                            <button type="button" id="btn-down" class="btn btn-sm btn-primary">
                                                <span class="glyphicon glyphicon-arrow-down"></span>
                                            </button>
                                        </div>
                                        <br/>
                                        <br/>
                                        <apex:commandLink styleClass="btn btn-sm btn-success" onclick="copiaValores();" action="{!SalvarOrdem}" style="width: 100%;">
                                            <span class="glyphicon glyphicon-floppy-save"></span>
                                        </apex:commandLink>
                                        <br/>
                                        <br/>
                                        <apex:outputText rendered="{!IF(mensagem == 'sucesso', true, false)}" >
                                            <div class="alert alert-success" style="margin:0px; padding-top:6px;padding-bottom:6px;padding-left:12px;padding-right:12px;display:inline-block!important; width:100%!important;">
                                              <strong>&#10004;</strong>
                                            </div>
                                        </apex:outputText>
                                    </div>
                                </apex:form>
                                
                                <div class="col-xs-45">
                                    <select class="form-control" size="14" multiple="true" id="principal" style="font-size:12px!important; overflow-x: scroll!important">
                                        <apex:repeat value="{!listaCategoria}" var="categoria">
                                            <apex:outputText rendered="{!IF(categoria.Ordem__c != null, true, false)}" >                                                
                                                <option name='item' value="{!categoria.Id}">{!categoria.Name}</option>
                                            </apex:outputText>
                                        </apex:repeat>
                                    </select>
                                </div>
                                
                                <!--botões  add/remove -->
                                <div class="col-xs-5" style="padding:0px;">
                                    <div class="btn-group-vertical" style="width: 100%;">
                                        <button type="button" class="btn btn-primary" id="btn-right">
                                            <span class="glyphicon glyphicon-arrow-right"></span>
                                        </button>
                                        
                                        <button type="button" class="btn btn-primary" id="btn-left">
                                            <span class="glyphicon glyphicon-arrow-left"></span>
                                        </button>
                                    </div>
                                </div>
                                <div class="col-xs-45">
                                    <div class="input-group">
                                        <input type="text" class="form-control" id='filtro'/>                           
                                        <span class="input-group-addon"><i class="glyphicon glyphicon-filter"></i></span>
                                    </div>
                                    <select class="form-control" size="12" multiple="true" id="auxiliar" style="font-size:12px!important; overflow-x: scroll!important">
                                        <apex:repeat value="{!listaCategoria}" var="categoria">
                                            <apex:outputText rendered="{!IF(categoria.Ordem__c == null, true, false)}" >                                                
                                                <option name='item' value="{!categoria.Id}">{!categoria.Name}</option>
                                            </apex:outputText>
                                        </apex:repeat>
                                    </select>
                                </div>
                                
                            </div>
                        </div>

                    </apex:outputText>
                    
                </div>        
            </div>        
        </body>
    </html>
</apex:page>