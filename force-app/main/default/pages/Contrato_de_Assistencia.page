<apex:page renderAs="pdf" standardController="WorkOrder" extensions="OrdemDeTrabalhoProposta" standardStylesheets="false" cache="false" showHeader="false" sidebar="false" applyHtmlTag="true" applyBodyTag="false">
    
    
    <!-- remover isso depois -->
    <apex:outputText rendered="{!IF(OR(
        ordem_de_trabalho.Condicao_de_pagamento__c==null,
        ordem_de_trabalho.Forma_de_pagamento2__c==null,
        ordem_de_trabalho.Frete2__c==null,
        ordem_de_trabalho.Prazo_de_Entrega__c==null, 
        ordem_de_trabalho.Prazo_de_garantia__c==null,
        ordem_de_trabalho.Data_de_emissao__c==null,
        ordem_de_trabalho.Data_de_validade__c==null,
        ordem_de_trabalho.AccountId==null,
        ordem_de_trabalho.ContactId==null,
        ordem_de_trabalho.Faturamento_Feito2__c==null
    ),true,false)}">
        Os campos Condição de pagamento, Forma de pagamento, Tipo de envio, Prazo de entrega, Prazo de garantia, Data de emissao
        Data de validade, Conta, Contato e Faturamento feito devem ser preenchidos para gerar a proposta.
    </apex:outputText>
    
    <apex:outputText rendered="{!IF(OR(
        ordem_de_trabalho.Condicao_de_pagamento__c==null,
        ordem_de_trabalho.Forma_de_pagamento2__c==null,
        ordem_de_trabalho.Frete2__c==null,
        ordem_de_trabalho.Prazo_de_Entrega__c==null, 
        ordem_de_trabalho.Prazo_de_garantia__c==null,
        ordem_de_trabalho.Data_de_emissao__c==null,
        ordem_de_trabalho.Data_de_validade__c==null,
        ordem_de_trabalho.AccountId==null,
        ordem_de_trabalho.ContactId==null,
        ordem_de_trabalho.Faturamento_Feito2__c==null
    ),false,true)}">

    <head>
        <style type="text/css" media="print">
            
            /* pdf */
            @page:first{
                size:A4;
                background: url({!documento.sobre});
                margin:150px 50px 120px 50px;
                @bottom-center{content:element(paginacao);}
            }
            @page{
                size:A4;
                background: url({!documento.timbrado});
                margin:150px 50px 120px 50px;
                @bottom-center{content:element(paginacao);}
            }
            .pagina:before{content:counter(page);}
            .paginas:before{content:counter(pages);}
            
            /* paginação */
            .paginacao{
                height:120px;
                position:running(paginacao);
            }.paginacao .valor{
                position: absolute;
                top: 74px;
                left: 410px;
                text-align:center;
                background-color:white;
                font-family:arial, verdana, sans-serif;
                font-size:12px;
                font-weight:600;
                color:#697f9b;
            }
            
            /* documento */
            .documento{
                padding:0px;
                margin:0px;
                font-family:arial, verdana, sans-serif;
            }.bloco{
                page-break-inside:avoid;
            }.linha{
                white-space: nowrap;
            }
            
            /* capa */
            .capa .titulo{
                margin-top:505px;
                width:100%;
                text-align:center;
                text-transform:uppercase;
                font-weight:bold;
                font-size:20px;
                white-space:pre;
            }.capa .numero{
                margin-top:40px;
                width:100%;
                text-align:right;
                font-size:14px;
            }.capa .rotulo{
                margin-top:35px;
                font-size:15px;
            }.capa .valor{
                margin-top:5px;
                margin-left:20px;
                font-size:17px;
                font-weight:bold;
            }.capa .nota{
                margin-top:5px;
                margin-left:20px;
                font-size:14px;
            }
            
            /* conteudo */
            .conteudo{
                page-break-before:always;
            }.conteudo .titulo{
                font-size:14px;
                font-weight:bold;
                line-height:120%;
            }.conteudo .paragrafo{
                font-size:13px;
                text-align:justify;
                line-height:120%;
                text-justify:inter-word;
            }.conteudo .obsimgs{
                text-align:right;
                font-size:11px;
                font-weight:bold;
                font-style:italic;
            }.conteudo .assinatura{
                width:100%;
            }.conteudo .assinatura td{
                width:50%;
                font-size:13px;
                line-height:130%;
            }.conteudo .nota{
                font-size:13px;
                text-align:justify;
                line-height:120%;
                font-style:italic;
            }
            
            /* listagem */
            .listagem{ 
                width:100%;
            }.listagem table{ 
                width:100%;
                border-collapse:collapse;
            }.listagem td{ 
                padding:2px 5px;
                line-height:120%;
            }.listagem .pre-cabecalho{
                height:10px;
            }.listagem .cabecalho td{
                font-size:12px;
                font-weight:bold;
                background-color:#e2e3e3;
                white-space: nowrap;
                border-color:#cacecf;
                border-style:solid;
                border-width:1px 0px 1px 0px;
            }.listagem .item-dados .imagem{
                vertical-align:middle;
            }.listagem .item-dados.acessorio .imagem{
                text-align:right;
            }.listagem .item-dados.equipamento img{
                width: 80px;
                height: 80px; 
            }.listagem .item-dados.acessorio img{
                width: 55px;
                height: 55px; 
            }.listagem .item-dados .valor{
                border-color:#eef2f4;
                border-style:solid;
                border-width:1px 0px 0px 0px;
            }.listagem .item-dados td{
                font-size:10px;
                vertical-align:top;
            }.listagem .item-descr td{
                font-size:10px;
                text-align:justify;
                vertical-align:top;
                text-justify:inter-word;
                border-color:#eef2f4;
                border-style:solid;
                border-width:0px 0px 1px 0px;
            }.listagem .subtotal{
                font-weight: bold;
                font-size:10px;
                white-space: nowrap;
            }.listagem .subtotal .valor{
                border-color:#eef2f4;
                border-style:solid;
                border-width:0px 0px 1px 0px;
            }
        </style>
    </head>
    
    <body class="documento">
        
        <!-- paginacao -->
        <div class="paginacao">
            <div class="valor" style="margin: -9px -70px">Contrato: {!WorkOrder.WorkOrderNumber} - Página <span class="pagina"/> de <span class="paginas"/></div>
        </div>
        
        <!-- capa -->
        <div class="capa">
            <div class="titulo">CONTRATO DE PRESTAÇÃO DE SERVIÇOS</div>
            <div style="text-align:center; font-size: 14pt"><b>Nº: {!ordem_de_trabalho.WorkOrderNumber}</b></div>
            
        </div>
        
        <!-- conteudo -->
        <div class="conteudo">
                        <apex:variable var="n1" value="{!0}"/><apex:variable var="n2" value="{!0}"/><apex:variable var="n3" value="{!0}"/>

            <apex:outputText rendered="{!!WorkOrder.Qualificacao_Assistencia_Editada__c}">
            <div class="bloco">
                <div class="paragrafo" style="text-align: justify;"><b>CONTRATADA: </b> <b>{!WorkOrder.Faturamento_Feito2__r.Raz_o_Social__c}</b>{!IF(WorkOrder.Faturamento_Feito2__r.Ownership = 'PUBLICO' , ', pessoa jurídica de direito público',', pessoa jurídica de direito privado')}, inscrita no CPNJ sob n.º: {!WorkOrder.Faturamento_Feito2__r.CNPJ__c}  sediada na {!WorkOrder.Faturamento_Feito2__r.BillingStreet}, {!WorkOrder.Faturamento_Feito2__r.BillingCity} - {!WorkOrder.Faturamento_Feito2__r.BillingState}, CEP: {!WorkOrder.Faturamento_Feito2__r.BillingPostalCode} e, de outro lado,</div>
                <br/>
               <apex:outputText rendered="{!IF(WorkOrder.Account.CNPJ__c != null, true, false)}">
                    <div class="paragrafo" style="text-align: justify;"><b>CONTRATANTE: </b> <b>{!WorkOrder.Account.Raz_o_Social__c}</b>{!IF(WorkOrder.Account.Ownership = 'PUBLICO' , ', pessoa jurídica de direito público',', pessoa jurídica de direito privado')}, inscrita no CNPJ sob n.º: {!WorkOrder.Account.CNPJ__c}, sediada na {!WorkOrder.Account.BillingStreet}, {!WorkOrder.Account.BillingCity}, {!WorkOrder.Account.BillingState}, CEP: {!WorkOrder.Account.BillingPostalCode}.</div>
                </apex:outputText>
                <apex:outputText rendered="{!IF(WorkOrder.Account.CNPJ__c == null, true, false)}">
                    <div class="paragrafo" style="text-align: justify;"><b>CONTRATANTE: </b> <b>{!WorkOrder.Account.Name}</b>, pessoa física inscrita no CPF sob o n.º {!WorkOrder.Account.CPF__pc}, RG n.º {!WorkOrder.Account.RG__pc} residente e domiciliado à {!WorkOrder.Account.BillingStreet}, {!WorkOrder.Account.BillingCity}, {!WorkOrder.Account.BillingState}, CEP: {!WorkOrder.Account.BillingPostalCode}</div>
                </apex:outputText>
                <br/>
                    <div class="paragrafo">Têm entre si justo e acertado o presente contrato de prestação de serviços, que se regerá pelas cláusulas e condições a seguir delineadas.</div>
                    <br/>
            </div>
            </apex:outputText>
            <apex:outputText rendered="{!WorkOrder.Qualificacao_Assistencia_Editada__c}">
            <div class="paragrafo">
            <apex:outputField value="{!WorkOrder.Qualificacao_Assistencia__c}">
            </apex:outputField>
            </div>
            </apex:outputText>            
            <div class="bloco">
                <apex:variable var="n1" value="{!n1+1}"/><apex:variable var="n2" value="{!0}"/><apex:variable var="n3" value="{!0}"/>
                <div class="titulo"><b>1. OBJETO </b></div>
                <br/>
                <div class="paragrafo"><b>1.1.</b> Constitui objeto do presente instrumento a prestação de serviços de manutenção e/ ou venda de peças  
                    <apex:outputText rendered="{!IF(ordem_de_trabalho.AssetId!=null,true,false)}" value="{!', referente ao ativo'}"/> 
                    <apex:outputText value="{!' '+ordem_de_trabalho.Asset.Name}"/> 
                    <apex:outputText rendered="{!IF(ordem_de_trabalho.Asset.Marca__c!=null,true,false)}" value="{!', Marca ' + ordem_de_trabalho.Asset.Marca__c}"/> 
                    <apex:outputText rendered="{!IF(ordem_de_trabalho.Asset.Modelo__c!=null,true,false)}" value="{!', Modelo ' + ordem_de_trabalho.Asset.Modelo__c}"/> 
                    <apex:outputText rendered="{!IF(ordem_de_trabalho.Asset.SerialNumber!=null,true,false)}" value="{!', Número de série '+ordem_de_trabalho.Asset.SerialNumber}"/> 
                    <apex:outputText rendered="{!IF(ordem_de_trabalho.Asset.patrimonio__c!=null,true,false)}" value="{!', Patrimônio '+ordem_de_trabalho.Asset.patrimonio__c}"/>.
                </div>
                <br/>
            </div>       
            
            <div class="listagem">
                <apex:variable var="subtotal" value="{!0}"/>
                
                <table cellpadding="0px" cellspacing="0px" border="0">
                       <apex:repeat value="{!WorkOrder.WorkOrderLineItems}" var="produto" >
                        <!--apex:outputText rendered="{!IF(produto.Tipo__c != 'SERVIÇO' && produto.Tipo__c != '', true, false)}"-->
                        <apex:outputText >
                        <tbody class='bloco'>

                            <!-- cabeçalho -->
                            <apex:outputText >
                                <tr class="pre-cabecalho"><tr cellspacing="7"></tr></tr>
                                <tr class="cabecalho">
                                    <td style="visibility:hidden;border:0px;"></td>
                                    <td>Imagem</td>
                                    <td>Produto</td>
                                    <td>Modelo</td>
                                    <td>Fabricante</td>
                                    <td>Valor Unit.</td>
                                    <td>Qtd.</td>
                                    <td>Valor Total</td>
                                </tr>
                            </apex:outputText>
                            
                            <!-- item -->
                            <apex:variable var="tipo" value="{!IF(produto.Item_Pai__c==null,'equipamento','acessorio')}"/>
                            <tr class="item-dados">
                                <td rowspan="2"><apex:outputText value="{!produto.Item__c}" rendered="{!IF(tipo=='equipamento',true,false)}"/></td>
                                <td rowspan="2" class="imagem"><img src="{!produto.Product2.URL_da_Imagem__c}" height="80px" width="80px"/></td>
                                <td class="valor">
                                    COD: {!produto.Product2.StockKeepingUnit}
                                    <!--apex:outputText value="{!', LOTE: '+produto.Lote__c}" rendered="{!IF(produto.Lote__c!=null,true,false)}" /-->
                                    <br/>
                                    {!produto.Product2.Name}
                                </td>
                                <td class="valor">{!produto.Product2.Modelo__c}</td>
                                <td class="valor">{!produto.Product2.Marca__c}</td>
                                <td class="linha valor"><apex:outputField value="{!produto.UnitPrice}"/></td>
                                <td class="linha valor"><apex:outputField value="{!produto.Quantity}"/></td>
                                <td class="linha valor"><apex:outputField value="{!produto.TotalPrice}"/></td>
                            </tr>
                            <tr class="item-descr">
                                <td colspan="6">
                                    <apex:outputText rendered="{!if(produto.Description !=null,true,false)}">
                                        <apex:outputText value="{!produto.Description}"/>.
                                    </apex:outputText>
                                    <apex:outputText rendered="{!if(produto.Product2.Numero_Anvisa__c!=null,true,false)}">
                                        Nº. ANVISA: {!produto.Product2.Numero_Anvisa__c}.
                                    </apex:outputText>
                                </td>                               
                            </tr>
                            
                            <!-- subtotal -->
                            <apex:variable var="subtotal" value="{!subtotal+produto.TotalPrice+1}"/>
                            <apex:outputText rendered="{!IF(produto.subtotal!=null,true,false)}">
                                <tr class="subtotal">
                                    <td colspan="2">&nbsp;</td>
                                    <td colspan="5" class="valor">SUBTOTAL</td>
                                    <td class="valor"><apex:outputText value="{0, number, 0.00}"><apex:param value="{!produto.subtotal}"/></apex:outputText></td>
                                </tr>
                                <apex:variable var="subtotal" value="{!0}"/>
                            </apex:outputText>
                        
                        </tbody>
                        </apex:outputText>
                    </apex:repeat>
                </table>
            </div>
            
            <br/>
            <div class="obsimgs">Imagens ilustrativas.</div>
            <br/>
                            <div class="paragrafo"><b>Valor total: </b> <apex:outputField value="{!WorkOrder.Total_Estimado__c}"/>.</div>
            <br/>
            <div class="bloco">
            <div class="titulo"><b>2. CONDIÇÕES GERAIS DO CONTRATO</b></div>
            <br/>
            <div class="paragrafo"><b>2.1. </b> Este instrumento será regido pelas seguintes informações comerciais:</div>
            <br/>
            <table cellspacing="0px" style="font-size: 13px">
                <tr>
                    <td style="border: 0.5px solid black; padding: 3px" width="170px">
                    <b>Valor Total</b>               
                    </td>
                    <td style="border: 0.5px solid black; padding: 3px" width="*">
                        <apex:outputField value="{!ordem_de_trabalho.GrandTotal}"/>
                    </td>
                </tr>
                
                <tr>
                    <td style="border: 0.5px solid black; padding: 3px">
                    <b>Forma de Pagamento</b>               
                    </td>
                    <td style="border: 0.5px solid black; padding: 3px">
                        <apex:outputField value="{!ordem_de_trabalho.Forma_de_pagamento2__c}"/>
                    </td>
                </tr>
                <apex:outputText rendered="{!IF(ordem_de_trabalho.Forma_de_pagamento2__c='Transferência Bancária',true,false)}"> 
                <tr>
                   <td style="border: 0.5px solid black; padding: 3px">
                    <b>Dados Bancários:</b>               
                    </td>
                    <td style="border: 0.5px solid black; padding: 3px">
                        {!documento.empresa_bancario}.
                    </td> 
                </tr>
                
                </apex:outputtext>
                
                <tr>
                    <td style="border: 0.5px solid black; padding: 3px">
                    <b>Condição de Pagamento</b>               
                    </td>
                    <td style="border: 0.5px solid black; padding: 3px">
                        <apex:outputText rendered="{!IF(ordem_de_trabalho.Condicao_de_pagamento__c = 'Condição Especial - Aprovado pela Diretoria', true, false)}">
                            <apex:outputField value="{!ordem_de_trabalho.Condicao_de_pagamento__c}"/>,&nbsp; <apex:outputField value="{!WorkOrder.Condi_o_especial__c}"/>
                        </apex:outputText>
                        <apex:outputText rendered="{!IF(ordem_de_trabalho.Condicao_de_pagamento__c = 'Condição Especial - Aprovado pela Diretoria', false, true)}">
                            <apex:outputField value="{!ordem_de_trabalho.Condicao_de_pagamento__c}"/>
                        </apex:outputText>
                    </td>
                </tr> 
                <!--Valor de entrada--> 
                <apex:outputText rendered="{!IF(WorkOrder.Valor_da_entrada__c != null, true, false)}">
                <tr>
                    <td style="border: 0.5px solid black; padding: 3px">
                    <b>Valor da Entrada</b>               
                    </td>
                    <td style="border: 0.5px solid black; padding: 3px">
                            <apex:outputField value="{!WorkOrder.Valor_da_entrada__c}"/>
                    </td>
                </tr> 
                </apex:outputText>
                <!-- Número de parcelas -->
                <apex:outputText rendered="{!IF(WorkOrder.Numero_de_parcelas__c!= null, true, false)}">
                <tr>
                    <td style="border: 0.5px solid black; padding: 3px">
                    <b>Número de parcelas</b>               
                    </td>
                    <td style="border: 0.5px solid black; padding: 3px">
                            <apex:outputField value="{!WorkOrder.Numero_de_parcelas__c}"/>
                    </td>
                </tr> 
                </apex:outputText>  
                <!-- 1ª parcela -->
                <apex:outputText rendered="{!IF(WorkOrder.Data_da_primeira_parcela__c != null, true, false)}">
                <tr>
                    <td style="border: 0.5px solid black; padding: 3px">
                    <b>Data da primeira parcela</b>               
                    </td>
                    <td style="border: 0.5px solid black; padding: 3px">
                            <apex:outputField value="{!WorkOrder.Data_da_primeira_parcela__c}"/>
                    </td>
                </tr> 
                </apex:outputText>  
                
                <tr>
                    <td style="border: 0.5px solid black; padding: 3px">
                    <b>Prazo de Entrega</b>               
                    </td>
                    <td style="border: 0.5px solid black; padding: 3px">
                        
                        {!ordem_de_trabalho.Prazo_de_entrega__c}, 
                        <apex:variable var="frete" value="{!IF(ordem_de_trabalho.Frete2__c=='Sem frete','','frete')}"/>
                        {!LOWER(ordem_de_trabalho.Frete2__c)}.
                    </td>
                </tr>
                
                <tr>
                    <td style="border: 0.5px solid black; padding: 3px">
                    <b>Frete</b>               
                    </td>
                    <td style="border: 0.5px solid black; padding: 3px">                       
                        <apex:variable var="frete" value="{!IF(ordem_de_trabalho.Frete2__c=='Sem frete','Sem Frete','frete')}"/>
                        {!LOWER(ordem_de_trabalho.Frete2__c)}.
                    </td>
                </tr>
                
                <tr>
                    <td style="border: 0.5px solid black; padding: 3px">
                    <b>Endereço de Faturamento</b>               
                    </td>
                    <td style="border: 0.5px solid black; padding: 3px">
                        <apex:outputText rendered="{!IF(ordem_de_trabalho.Account.BillingStreet != null,true,false)}" > {!ordem_de_trabalho.Account.BillingStreet}</apex:outputText>
                        <apex:outputText rendered="{!IF(ordem_de_trabalho.Account.BillingCity != null,true,false)}" >, {!ordem_de_trabalho.Account.BillingCity}</apex:outputText>
                        <apex:outputText rendered="{!IF(ordem_de_trabalho.Account.BillingStateCode != null,true,false)}" >-{!ordem_de_trabalho.Account.BillingStateCode}</apex:outputText>
                        <apex:outputText rendered="{!IF(ordem_de_trabalho.Account.BillingPostalCode != null,true,false)}" >, CEP: {!ordem_de_trabalho.Account.BillingPostalCode}</apex:outputText>                       
                    </td>
                </tr>
                
                <tr>
                    <td style="border: 0.5px solid black; padding: 3px">
                    <b>Endereço de Entrega</b>               
                    </td>
                    <td style="border: 0.5px solid black; padding: 3px">
                        <apex:outputText rendered="{!IF(ordem_de_trabalho.Account.ShippingStreet != null,true,false)}" > {!ordem_de_trabalho.Account.ShippingStreet}</apex:outputText>
                        <apex:outputText rendered="{!IF(ordem_de_trabalho.Account.ShippingCity != null,true,false)}" >, {!ordem_de_trabalho.Account.ShippingCity}</apex:outputText>
                        <apex:outputText rendered="{!IF(ordem_de_trabalho.Account.ShippingStateCode != null,true,false)}" >-{!ordem_de_trabalho.Account.ShippingStateCode}</apex:outputText>
                        <apex:outputText rendered="{!IF(ordem_de_trabalho.Account.ShippingPostalCode != null,true,false)}" >, CEP: {!ordem_de_trabalho.Account.ShippingPostalCode}</apex:outputText>
                    </td>
                </tr>
            </table>
            <br/>
            </div>
            <div class="paragrafo"><apex:outputField value="{!WorkOrder.A_Clausula2__c}"/></div>
            <br/>
            <br/>
            <div class="paragrafo"><apex:outputField value="{!WorkOrder.A_Clausula3__c}"/></div>
            <br/>
            <br/>
            <div class="paragrafo"><apex:outputField value="{!WorkOrder.A_Clausula4__c}"/></div>
            <br/>
            <br/>
            <div class="paragrafo"><apex:outputField value="{!WorkOrder.A_Clausula5__c}"/></div>
            <br/>
            <br/>
            <div class="paragrafo"><apex:outputField value="{!WorkOrder.A_Clausula6__c}"/></div>
            <br/>
            <br/>
            <div class="paragrafo"><apex:outputField value="{!WorkOrder.A_Clausula7__c}"/></div>
            <br/>
            <br/>
            <div class="paragrafo"><apex:outputField value="{!WorkOrder.A_Clausula8__c}"/></div>
            <br/>
            <br/>
            <div class="paragrafo"><apex:outputField value="{!WorkOrder.A_Clausula9__c}"/></div>
            <br/>
            <br/>
            <div class="paragrafo"><apex:outputField value="{!WorkOrder.A_Clausula10__c}"/></div>
            <br/>
            <br/>
            <div class="paragrafo"><apex:outputField value="{!WorkOrder.A_Clausula11__c}"/></div>
            <br/>
            <br/>
            <div class="paragrafo"><apex:outputField value="{!WorkOrder.A_Clausula12__c}"/></div>

            
            <br/>
                <div style="page-break-inside: avoid;">

            <div style="text-align: justify"><apex:outputField value="{!WorkOrder.A_Clausula13__c}"/></div><br/><br/><br/>
            
                <table class="assinatura" style = "font-size: 12px">
                <tr>
                    <td>
                    
                    </td>
                    <td style="text-align:right">
                    Goiânia, ____/____/________
                    </td>
                </tr>
                    <tr>
                        <td>
                            <br/><br/>____________________________________
                            <br/>{!WorkOrder.Faturamento_Feito2__r.Raz_o_Social__c}
                            <br/>Data da assinatura: 
                        </td>
                        <td>
                            <br/><br/>____________________________________
                            <br/>{!WorkOrder.Account.Name}
                            <br/>Nome: 
                             
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <br/><br/>____________________________________
                            <br/>Testemunha 1
                            <br/>Nome: 
                            <br/>CPF: 
                        </td>
                        <td>
                            <br/><br/>____________________________________
                            <br/>Testemunha 2
                            <br/>Nome: 
                            <br/>CPF: 
                        </td>
                    </tr>
                </table>
                </div>
                <br/>
                            
           </div>            
        
    </body>
    </apex:outputText>
</apex:page>