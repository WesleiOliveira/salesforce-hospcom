<apex:page standardController="Solicita_o_de_devolu_o__c" 
           extensions="SolicitacaoDevolucaoController" 
           renderAs="pdf" 
           applyBodyTag="false" 
           showHeader="false">
    
    <head>
        <style>
            @page {
                size: A4;
                background: url({!$Resource.TimbradoHospcom});
                margin: 150px 50px 120px 50px;
                
                @bottom-center {
                    content: element(footer);
                }
            }
            
            body {
                font-family: Arial, sans-serif;
                font-size: 12px;
                color: #333;
            }
            
            /* Cabeçalho */
            .header-section {
                margin-bottom: 30px;
                padding: 20px;
                border: 1px solid #ddd;
                background-color: #f9f9f9;
                border-radius: 5px;
            }
            
            .header-title {
                font-size: 18px;
                font-weight: bold;
                color: #0070d2;
                margin-bottom: 15px;
                border-bottom: 2px solid #0070d2;
                padding-bottom: 10px;
            }
            
            .header-info {
                display: table;
                width: 100%;
                margin-bottom: 10px;
            }
            
            .header-row {
                display: table-row;
            }
            
            .header-label {
                display: table-cell;
                font-weight: bold;
                width: 30%;
                padding: 5px;
                color: #555;
            }
            
            .header-value {
                display: table-cell;
                padding: 5px;
                width: 70%;
            }
            
            .observacoes-box {
                margin-top: 10px;
                padding: 10px;
                background-color: #fff;
                border: 1px solid #ddd;
                border-radius: 3px;
                min-height: 50px;
            }
            
            /* Corpo - Lista de Itens */
            .items-section {
                margin-top: 20px;
            }
            
            .items-header {
                font-size: 16px;
                font-weight: bold;
                color: #0070d2;
                margin-bottom: 15px;
                padding: 10px;
                background-color: #f4f6f9;
                border-left: 4px solid #0070d2;
            }
            
            .total-count {
                color: #0070d2;
                font-size: 14px;
                font-weight: normal;
            }
            
            /* Card do Item */
            .item-card {
                display: table;
                width: 100%;
                margin-bottom: 15px;
                padding: 15px;
                border: 1px solid #ddd;
                background-color: #fff;
                border-radius: 5px;
                page-break-inside: avoid;
            }
            
            .item-image {
                display: table-cell;
                width: 80px;
                vertical-align: top;
                padding-right: 15px;
            }
            
            .item-image img {
                max-width: 70px;
                max-height: 70px;
                border: 1px solid #ddd;
                border-radius: 3px;
            }
            
            .item-content {
                display: table-cell;
                vertical-align: top;
            }
            
            .item-number {
                color: #999;
                font-size: 11px;
                margin-bottom: 5px;
            }
            
            .item-name {
                font-size: 15px;
                font-weight: bold;
                color: #0070d2;
                margin-bottom: 10px;
            }
            
            .item-details {
                display: table;
                width: 100%;
            }
            
            .detail-row {
                display: table-row;
            }
            
            .detail-label {
                display: table-cell;
                font-weight: bold;
                width: 25%;
                padding: 3px 5px;
                color: #555;
            }
            
            .detail-value {
                display: table-cell;
                padding: 3px 5px;
                width: 75%;
            }
            
            .truncate {
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                max-width: 100%;
            }
            
            /* Rodapé */
            #footer {
                position: running(footer);
                text-align: center;
                font-size: 10px;
                color: #666;
                padding-top: 10px;
                border-top: 1px solid #ddd;
            }
            
            .no-items {
                padding: 30px;
                text-align: center;
                color: #999;
                font-style: italic;
            }
        </style>
    </head>
    
    <body>
        <!-- Cabeçalho com Informações da Solicitação -->
        <div class="header-section">
            <div class="header-title">
                Solicitação de Devolução
            </div>
            
            <div class="header-info">
                <div class="header-row">
                    <div class="header-label">Número:</div>
                    <div class="header-value">{!Solicita_o_de_devolu_o__c.Name}</div>
                </div>
                <div class="header-row">
                    <div class="header-label">Tipo:</div>
                    <div class="header-value">{!Solicita_o_de_devolu_o__c.Tipo__c}</div>
                </div>
                <div class="header-row">
                    <div class="header-label">Pedido:</div>
                    <div class="header-value">{!Solicita_o_de_devolu_o__c.Pedido__r.OrderNumber}</div>
                </div>
                <div class="header-row">
                    <div class="header-label">Data de Criação:</div>
                    <div class="header-value">
                        <apex:outputText value="{0,date,dd/MM/yyyy HH:mm}">
                            <apex:param value="{!Solicita_o_de_devolu_o__c.CreatedDate}" />
                        </apex:outputText>
                    </div>
                </div>
                <div class="header-row">
                    <div class="header-label">Proprietário:</div>
                    <div class="header-value">{!Solicita_o_de_devolu_o__c.Owner.Name}</div>
                </div>
            </div>
            
            <apex:outputPanel rendered="{!NOT(ISBLANK(Solicita_o_de_devolu_o__c.Observacoes__c))}">
                <div class="header-label" style="margin-top: 10px;">Observações:</div>
                <div class="observacoes-box">
                    <apex:outputText value="{!Solicita_o_de_devolu_o__c.Observacoes__c}" escape="false" />
                </div>
            </apex:outputPanel>
        </div>
        
        <!-- Corpo - Lista de Itens -->
        <div class="items-section">
            <div class="items-header">
                Itens da Solicitação 
                <span class="total-count">({!totalItens} {!IF(totalItens == 1, 'item', 'itens')})</span>
            </div>
            
            <apex:outputPanel rendered="{!temItens}">
                <apex:repeat value="{!listaItens}" var="item" id="itemsList">
                    <div class="item-card">
                        <div class="item-image">
                            <apex:outputText value="{!item.imagem__c}" escape="false" />
                        </div>
                        
                        <div class="item-content">
                            <div class="item-number">
                                Item #{!item.Name}
                            </div>
                            
                            <div class="item-name">
                                {!item.nomeProduto__c}
                            </div>
                            
                            <div class="item-details">
                                <div class="detail-row">
                                    <div class="detail-label">Quantidade:</div>
                                    <div class="detail-value">{!item.Quantidade__c}</div>
                                </div>
                                
                                <div class="detail-row">
                                    <div class="detail-label">Valor:</div>
                                    <div class="detail-value">
                                        <apex:outputText value="{0, number, currency}">
                                            <apex:param value="{!item.Valor_do_Produto_do_Pedido__c}" />
                                        </apex:outputText>
                                    </div>
                                </div>
                                
                                <apex:outputPanel rendered="{!NOT(ISBLANK(item.numeroSerie__c))}">
                                    <div class="detail-row">
                                        <div class="detail-label">Número de Série:</div>
                                        <div class="detail-value truncate">
                                            <apex:outputText value="{!IF(LEN(item.numeroSerie__c) > 100, 
                                                                        LEFT(item.numeroSerie__c, 100) & '...', 
                                                                        item.numeroSerie__c)}" />
                                        </div>
                                    </div>
                                </apex:outputPanel>
                            </div>
                        </div>
                    </div>
                </apex:repeat>
            </apex:outputPanel>
            
            <apex:outputPanel rendered="{!NOT(temItens)}">
                <div class="no-items">
                    Nenhum item encontrado para esta solicitação de devolução.
                </div>
            </apex:outputPanel>
        </div>
        
        <!-- Rodapé -->
        <div id="footer">
            <div>
                Proprietário: {!Solicita_o_de_devolu_o__c.Owner.Name} | 
                Data de Criação: 
                <apex:outputText value="{0,date,dd/MM/yyyy}">
                    <apex:param value="{!Solicita_o_de_devolu_o__c.CreatedDate}" />
                </apex:outputText>
            </div>
        </div>
    </body>
</apex:page>